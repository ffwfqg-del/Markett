# ๐ ะะฐะบ ัะฒัะทะฐะฝ ััะพะฝัะตะฝะด (Vercel) ั ะฑัะบะตะฝะดะพะผ (VPS)

## ๐ ะกัะตะผะฐ ัะฐะฑะพัั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ะะะะฌะะะะะขะะะฌ                            โ
โ              (Telegram Web App)                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                        โ
                        โ 1. ะะพะปัะทะพะฒะฐัะตะปั ะฒะฒะพะดะธั ัะตะปะตัะพะฝ
                        โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              VERCEL (Frontend + API)                        โ
โ                                                              โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  Frontend (React)                                    โ   โ
โ  โ  fetch("/api/auth/request-code")  โ ะัะฟัะฐะฒะปัะตั      โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                          โ                                   โ
โ                          โ 2. ะกะพััะฐะฝัะตั ะทะฐะฟัะพั              โ
โ                          โผ                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  API Routes (/api/...)                              โ   โ
โ  โ  - /api/auth/request-code  โ ะกะพะทะดะฐะตั ะทะฐะฟัะพั        โ   โ
โ  โ  - /api/telegram/get-pending  โ ะะพั ะพะฟัะฐัะธะฒะฐะตั     โ   โ
โ  โ  - /api/telegram/update-request โ ะะพั ะพัะฟัะฐะฒะปัะตั   โ   โ
โ  โ                                                      โ   โ
โ  โ  ะฅัะฐะฝะธั ะทะฐะฟัะพัั ะฒ ะฟะฐะผััะธ (auth-store)              โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โ 3. ะะพั ะพะฟัะฐัะธะฒะฐะตั ะบะฐะถะดัะต 0.5 ัะตะบ
                            โ    GET /api/telegram/get-pending
                            โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              VPS (Python Bot)                              โ
โ                                                              โ
โ  - ะะพะปััะฐะตั ะทะฐะฟัะพัั ัะตัะตะท get-pending                      โ
โ  - ะะฑัะฐะฑะฐััะฒะฐะตั ะฐะฒัะพัะธะทะฐัะธั (ะพัะฟัะฐะฒะปัะตั ะบะพะด ะฒ Telegram)   โ
โ  - ะะฑะฝะพะฒะปัะตั ััะฐััั ัะตัะตะท update-request                   โ
โ                                                              โ
โ  settings.json:                                             โ
โ  {                                                          โ
โ    "api_url": "https://your-app.vercel.app"  โ URL Vercel โ
โ  }                                                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                        โ
                        โ 4. ะัะฟัะฐะฒะปัะตั ััะฐััั ะพะฑัะฐัะฝะพ
                        โ    POST /api/telegram/update-request
                        โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              VERCEL (API)                                   โ
โ                                                              โ
โ  - ะะฑะฝะพะฒะปัะตั ััะฐััั ะทะฐะฟัะพัะฐ                                โ
โ  - Frontend ะพะฟัะฐัะธะฒะฐะตั ััะฐััั ัะตัะตะท polling                โ
โ  - ะะพะบะฐะทัะฒะฐะตั ะบะพะด ะฟะพะปัะทะพะฒะฐัะตะปั                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## โ ะงัะพ ะฃะะ ะฝะฐัััะพะตะฝะพ (ัะฐะฑะพัะฐะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ)

### 1. ะคัะพะฝัะตะฝะด โ API ะฝะฐ Vercel
ะคัะพะฝัะตะฝะด ะธัะฟะพะปัะทัะตั **ะพัะฝะพัะธัะตะปัะฝัะต ะฟััะธ** `/api/...`, ััะพ ะพะทะฝะฐัะฐะตั:
- โ ะคัะพะฝัะตะฝะด ะธ API ะฝะฐ **ะพะดะฝะพะผ ะดะพะผะตะฝะต** (Vercel)
- โ ะะต ะฝัะถะฝะพ ะฝะฐัััะฐะธะฒะฐัั CORS
- โ ะะฐะฑะพัะฐะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ

**ะัะธะผะตั:**
```typescript
// ะ ะบะพะดะต ััะพะฝัะตะฝะดะฐ
fetch("/api/auth/request-code", { ... })
// ะญัะพ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฑัะฐัะฐะตััั ะบ:
// https://your-app.vercel.app/api/auth/request-code
```

### 2. API ะฝะฐ Vercel ััะฐะฝะธั ะทะฐะฟัะพัั
- โ ะัะฟะพะปัะทัะตั `auth-store` (ะฒ ะฟะฐะผััะธ)
- โ API endpoints ัะถะต ัะพะทะดะฐะฝั
- โ ะะฐะฑะพัะฐะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ

### 3. ะะพั โ API ะฝะฐ Vercel
- โ ะะพั ะพะฟัะฐัะธะฒะฐะตั API ะบะฐะถะดัะต 0.5 ัะตะบัะฝะดั
- โ ะะพะปััะฐะตั pending ะทะฐะฟัะพัั
- โ ะัะฟัะฐะฒะปัะตั ะพะฑะฝะพะฒะปะตะฝะธั ััะฐัััะฐ

## ๐ง ะงัะพ ะฝัะถะฝะพ ะฝะฐัััะพะธัั

### 1. ะ Vercel (Environment Variables)

ะะพะฑะฐะฒััะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั:

```
NEXT_PUBLIC_API_URL=https://your-app.vercel.app
NEXT_PUBLIC_BOT_TOKEN=ะฒะฐั_ัะพะบะตะฝ
NEXT_PUBLIC_BOT_USERNAME=ะฒะฐั_ะฑะพั
API_ID=ะฒะฐั_api_id
API_HASH=ะฒะฐั_api_hash
ADMIN_IDS=ะฒะฐั_admin_id
```

**ะะฐะถะฝะพ:** `NEXT_PUBLIC_API_URL` ะดะพะปะถะตะฝ ะฑััั URL ะฒะฐัะตะณะพ Vercel ะฟัะธะปะพะถะตะฝะธั!

### 2. ะ settings.json ะฑะพัะฐ (ะฝะฐ VPS)

```json
{
  "api_url": "https://your-app.vercel.app"
}
```

**ะะฐะถะฝะพ:** ะญัะพ ะดะพะปะถะตะฝ ะฑััั ัะพั ะถะต URL, ััะพ ะธ `NEXT_PUBLIC_API_URL`!

## ๐ ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั ะฟะพัะฐะณะพะฒะพ

### ะัะธะผะตั: ะะฒัะพัะธะทะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปั

1. **ะะพะปัะทะพะฒะฐัะตะปั** ะพัะบััะฒะฐะตั Web App ะฝะฐ Vercel
   - URL: `https://your-app.vercel.app`

2. **ะคัะพะฝัะตะฝะด** ะพัะฟัะฐะฒะปัะตั ะทะฐะฟัะพั:
   ```javascript
   fetch("/api/auth/request-code", {
     method: "POST",
     body: JSON.stringify({
       telegramId: 123456789,
       phone: "+79991234567"
     })
   })
   ```

3. **API ะฝะฐ Vercel** ัะพะทะดะฐะตั ะทะฐะฟัะพั:
   - ะกะพััะฐะฝัะตั ะฒ `auth-store`
   - ะะพะทะฒัะฐัะฐะตั `requestId`

4. **ะะพั ะฝะฐ VPS** ะพะฟัะฐัะธะฒะฐะตั API:
   ```python
   # ะะฐะถะดัะต 0.5 ัะตะบัะฝะดั
   GET https://your-app.vercel.app/api/telegram/get-pending
   # ะะพะปััะฐะตั: { "requests": [{ "requestId": "...", "phone": "...", ... }] }
   ```

5. **ะะพั** ะพะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟัะพั:
   - ะัะฟัะฐะฒะปัะตั ะบะพะด ะฒ Telegram ะฟะพะปัะทะพะฒะฐัะตะปั
   - ะะฑะฝะพะฒะปัะตั ััะฐััั:
   ```python
   POST https://your-app.vercel.app/api/telegram/update-request
   Body: { "requestId": "...", "status": "waiting_code", ... }
   ```

6. **ะคัะพะฝัะตะฝะด** ะพะฟัะฐัะธะฒะฐะตั ััะฐััั:
   ```javascript
   // Polling ะบะฐะถะดัะต 1-2 ัะตะบัะฝะดั
   fetch("/api/telegram/check-status?requestId=...")
   // ะะพะปััะฐะตั: { "status": "waiting_code", ... }
   ```

7. **ะะพะปัะทะพะฒะฐัะตะปั** ะฒะธะดะธั ะบะพะด ะฒ Telegram ะธ ะฒะฒะพะดะธั ะตะณะพ

8. **ะคัะพะฝัะตะฝะด** ะพัะฟัะฐะฒะปัะตั ะบะพะด:
   ```javascript
   fetch("/api/auth/verify-code", {
     body: JSON.stringify({ code: "12345" })
   })
   ```

9. **API** ัะพะทะดะฐะตั ะฝะพะฒัะน ะทะฐะฟัะพั ั ะบะพะดะพะผ

10. **ะะพั** ะฟะพะปััะฐะตั ะบะพะด ะธ ะฐะฒัะพัะธะทัะตั ะฟะพะปัะทะพะฒะฐัะตะปั

11. **ะะพั** ะพะฑะฝะพะฒะปัะตั ััะฐััั: `status: "success"`

12. **ะคัะพะฝัะตะฝะด** ะฟะพะปััะฐะตั ััะฟะตัะฝัะน ััะฐััั ะธ ะฐะฒัะพัะธะทัะตั ะฟะพะปัะทะพะฒะฐัะตะปั

## ๐ ะัะพะฒะตัะบะฐ ัะฒัะทะธ

### 1. ะัะพะฒะตัััะต ััะพะฝัะตะฝะด โ API

ะัะบัะพะนัะต ะบะพะฝัะพะปั ะฑัะฐัะทะตัะฐ (F12) ะธ ะฟัะพะฒะตัััะต:
- ะะตั ะพัะธะฑะพะบ CORS
- ะะฐะฟัะพัั ะบ `/api/...` ะฟัะพัะพะดัั ััะฟะตัะฝะพ
- ะกัะฐััั 200 OK

### 2. ะัะพะฒะตัััะต ะฑะพั โ API

ะ ะปะพะณะฐั ะฑะพัะฐ ะดะพะปะถะฝะพ ะฑััั:
```
[INFO] Polling API...
[INFO] Found X pending request(s)
```

ะัะปะธ ะพัะธะฑะบะธ:
```
[ERROR] Connection refused
[ERROR] 404 Not Found
```
โ ะัะพะฒะตัััะต `api_url` ะฒ `settings.json`

### 3. ะัะพะฒะตัััะต API endpoints

ะัะบัะพะนัะต ะฒ ะฑัะฐัะทะตัะต:
```
https://your-app.vercel.app/api/telegram/get-pending
```

ะะพะปะถะตะฝ ะฒะตัะฝััั JSON:
```json
{
  "success": true,
  "requests": [...]
}
```

## โ๏ธ ะะฐัััะพะนะบะธ

### ะ Vercel:
```
NEXT_PUBLIC_API_URL=https://your-app.vercel.app  โ ะะฐั URL
```

### ะ settings.json ะฑะพัะฐ:
```json
{
  "api_url": "https://your-app.vercel.app"  โ ะขะพั ะถะต URL
}
```

## โ ะงะตะบะปะธัั

- [ ] Vercel ะฟัะธะปะพะถะตะฝะธะต ะทะฐะดะตะฟะปะพะตะฝะพ
- [ ] `NEXT_PUBLIC_API_URL` = URL ะฒะฐัะตะณะพ Vercel ะฟัะธะปะพะถะตะฝะธั
- [ ] `api_url` ะฒ `settings.json` = ัะพั ะถะต URL
- [ ] ะะพั ะทะฐะฟััะตะฝ ะฝะฐ VPS
- [ ] ะะพั ะพะฟัะฐัะธะฒะฐะตั API (ะฝะตั ะพัะธะฑะพะบ ะฒ ะปะพะณะฐั)
- [ ] ะคัะพะฝัะตะฝะด ะพัะฟัะฐะฒะปัะตั ะทะฐะฟัะพัั (ะฝะตั ะพัะธะฑะพะบ ะฒ ะบะพะฝัะพะปะธ)
- [ ] ะขะตััะพะฒะฐั ะฐะฒัะพัะธะทะฐัะธั ัะฐะฑะพัะฐะตั

## ๐ ะัะพะฑะปะตะผั ะธ ัะตัะตะฝะธั

### ะัะพะฑะปะตะผะฐ: ะคัะพะฝัะตะฝะด ะฝะต ะผะพะถะตั ะพัะฟัะฐะฒะธัั ะทะฐะฟัะพั

**ะะตัะตะฝะธะต:**
- ะัะพะฒะตัััะต, ััะพ ะธัะฟะพะปัะทัะตัะต ะพัะฝะพัะธัะตะปัะฝัะต ะฟััะธ `/api/...`
- ะะต ะธัะฟะพะปัะทัะนัะต `NEXT_PUBLIC_API_URL` ะฒ fetch (ัะพะปัะบะพ ะดะปั ะดััะณะธั ัะตะปะตะน)
- ะัะพะฒะตัััะต ะบะพะฝัะพะปั ะฑัะฐัะทะตัะฐ ะฝะฐ ะพัะธะฑะบะธ

### ะัะพะฑะปะตะผะฐ: ะะพั ะฝะต ะฟะพะปััะฐะตั ะทะฐะฟัะพัั

**ะะตัะตะฝะธะต:**
1. ะัะพะฒะตัััะต `api_url` ะฒ `settings.json`
2. ะัะพะฒะตัััะต ะดะพัััะฟะฝะพััั API: `curl https://your-app.vercel.app/api/telegram/get-pending`
3. ะัะพะฒะตัััะต ะปะพะณะธ ะฑะพัะฐ

### ะัะพะฑะปะตะผะฐ: ะะฐะฟัะพัั ัะตัััััั

**ะะตัะตะฝะธะต:**
- `auth-store` ััะฐะฝะธั ะฒ ะฟะฐะผััะธ - ะฟัะธ ะฟะตัะตะทะฐะฟััะบะต Vercel ะดะฐะฝะฝัะต ัะตัััััั
- ะะปั production ะธัะฟะพะปัะทัะนัะต ะฒะฝะตัะฝัั ะะ (PostgreSQL, MongoDB)

## ๐ฏ ะัะพะณะพ

**ะคัะพะฝัะตะฝะด ะธ API ัะถะต ัะฒัะทะฐะฝั** - ะพะฝะธ ะฝะฐ ะพะดะฝะพะผ ะดะพะผะตะฝะต (Vercel).

**ะะฐะผ ะฝัะถะฝะพ ัะพะปัะบะพ:**
1. ะฃะบะฐะทะฐัั ะฟัะฐะฒะธะปัะฝัะน URL ะฒ `settings.json` ะฑะพัะฐ
2. ะะฐะฟัััะธัั ะฑะพัะฐ ะฝะฐ VPS
3. ะฃะฑะตะดะธัััั, ััะพ ะฑะพั ะผะพะถะตั ะพะฑัะฐัะฐัััั ะบ Vercel API

**ะัั ะพััะฐะปัะฝะพะต ัะฐะฑะพัะฐะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ!** ๐

